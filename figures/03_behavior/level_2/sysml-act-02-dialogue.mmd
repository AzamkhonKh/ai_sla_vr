graph TB
    Start([User speaks])
    
    STT["1. Speech-to-Text<br/>200-500ms"]
    
    Context["2. Load Context<br/>50ms"]
    
    LLM["3. Generate Response<br/>800-1200ms"]
    
    TTS["4. Text-to-Speech<br/>200-300ms"]
    
    End([Audio response])
    
    Start --> STT
    STT --> Context
    Context --> LLM
    LLM --> TTS
    TTS --> End
    
    style Start fill:#e8f5e9
    style STT fill:#fff9c4
    style Context fill:#f3e5f5
    style LLM fill:#ffccbc
    style TTS fill:#ffe082
    style End fill:#e8f5e9
    
    CacheResponse --> SynthesizeAudio
    SynthesizeAudio --> LogMetrics
    LogMetrics --> End
    
    style Start fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
    style End fill:#ffebee,stroke:#c62828,stroke-width:2px
    style TranscribeAudio fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    style CheckCache fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    style LoadContext fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    style LoadScenario fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    style BuildPrompt fill:#f3e5f5,stroke:#6a1b9a,stroke-width:2px
    style CallLLM fill:#f3e5f5,stroke:#6a1b9a,stroke-width:2px
    style ValidateResponse fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    style RetryCount fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    style AdjustPrompt fill:#f3e5f5,stroke:#6a1b9a,stroke-width:2px
    style FallbackResponse fill:#ffebee,stroke:#c62828,stroke-width:2px
    style CacheResponse fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    style SynthesizeAudio fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    style LogMetrics fill:#e0f2f1,stroke:#004d40,stroke-width:2px
